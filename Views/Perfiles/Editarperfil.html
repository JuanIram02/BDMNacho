<!DOCTYPE HTML>
<html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Semana 1</title>
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<link rel="stylesheet" href="../StylesNewProduct.CSS">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">


<style>
    .max-img {
    max-width: 100%;
    max-height: 200px; /* Ajusta la altura máxima según sea necesario */
    }
</style>

</head>



<body >

    <div class="container-fluid" >
        <div class="row">
            <div class="col-lg-2 col-md-3 sb Sidebar d-none d-sm-block"   >
                       
                    <div class="col">
                        <ul>
                            <a href="Perfil01.html"><li>Mi perfil</li></a>
                            <a href="Chat.html"><li>Mis chats</li></a>
                            <a href="../PaginaInicio.html"><li>Principal</li></a>                           
                            <a href="../LoginVentanas/Login.html"><li>Cerrar Sesion</li></a>
                          
                        </ul>
                    </div>


            </div>
            <div class="col-lg-10 col-md-9" >
                <div class="row buscarDiv">

                    <div class="row logoRow">
                        <div class="col-11"><h1>LOGO</h1></div>
                        <div class="col-1"><a href="Carrito.html">
                            <img src="../../Public/cart.png" alt="Carrito" class="img-fluid h-50" alt="Responsive image">


                        </a></div>

                    </div>

                    <div class="col">
                    <hr>
                <input type="" class="form-control buscarTXT" id="exampleInputEmail1" aria-describedby="" placeholder="Buscar">
                <button type="button" class="btn btn-dark">Buscar</button> 
                <hr>
                </div>
                </div>
                <!----img src="Resources/doggo.png" alt="Logo perro" width="87" class="img-fluid" alt="Responsive image" -->   

                <div class="LoginInfo" >
                    <h1>Editar mis datos</h1>
                    
                    
                    
                    
                        <div class="container">
                            <form id="editForm" method="POST" enctype="multipart/form-data">
                                <input name="id" id="sesion" type="hidden">
                                <div class="row">
                                    <div class="col EspForms">
                                        <div class="form-group mb-2">
                                            <label for="input-imagen" class="btn btn-primary btn-imagen">
                                                <i class="fa fa-image"></i>
                                            </label>
                                            <label for="imagen">Imagen de Perfil</label>
                                            <input type="file" name="img" id="input-imagen" class="input-file visually-hidden" onchange="mostrarImagen()" accept="image/*">
                                        </div>
                                        <img class="max-img" id="imagen-previa" src="#" alt="Vista previa de la imagen">
                                    </div>
                        
                                    <div class="col EspForms">
                        
                                            <h2>Correo:</h2>
                                                <h3 id="correo">MiCorreo@email.com</h3>
                                            
                                            <br>
                                            <h2>Usuario:</h2>
                                            <input name="usuario" type="text" class="form-control" id="userName" placeholder="Ejemplo@email.com" required>
                        
                                    </div>
                        
                                </div>
                    
                    
                                <div class="row">
                                    <div class="col EspForms">
                                        <h2>Contaseña:</h2>
                                        <div class="input-group">
                                            <input name="contrasena" type="password" id="contrasena" class="form-control" placeholder="Contaseña" required>
                                            <button type="button" id="togglePassword" class="btn btn-primary">
                                                <i class="bi bi-eye-slash"></i> 
                                            </button>
                                        </div>
                    
                                    </div>
                    
                                    <div class="col EspForms">
                                        <h2>Confirmar contaseña:</h2>
                                        <div class="input-group">
                                            <input name="confirmar_contrasena" type="password" id="confirmar_contrasena" class="form-control"placeholder="Confirmar Contaseña" required>
                                            <button type="button" id="togglePassword2" class="btn btn-primary">
                                                <i class="bi bi-eye-slash"></i> 
                                            </button>
                                        </div>
                    
                                    </div>
                                
                                
                                </div>
                    
                    
                    
                                <div class="row">
                                    <div class="col EspForms">
                                        <h2>Fecha de nacimiento:</h2>
                                        <input name="fecha_nacimiento" id="fechaNac" type="date" class="form-control" required>
                    
                                    </div>
                    
                                    <div class="col EspForms">
                                        <h2>Sexo:</h2>
                                        <select name="sexo" id="Sexo" class="form-control" required>
                                            <option value="0">Masculino</option>
                                            <option value="1">Femenino</option>
                                            <option value="2">No especificar</option>
                                        </select>
                                    </div>
                                
                                
                                </div>
                    
                                <div class="row">
                                    <div class="col EspForms">
                    
                                        
                                        <h2><input name="perfil_privado" class="form-check-input" type="checkbox" id="privacidad"> Perfil privado</h2>
                                        
                    
                                    </div>
                    
                                    <div class="col EspForms">
                                        <h2>Tipo de cuenta:</h2><br>
                                        <h3 id="tipo_cuenta">Comprador</h3>
                    
                                    </div>
                    
                                
                                
                                </div>
                    
                                <div id="message" class="text-white bg-danger">

                                </div>
                    
                                <div class="row">
                                    
                                    <div class="col EspForms Botones" > <a href="Perfil01.html">
                                        <button type="submit" class="btn btn-light btn-lg" id="changesPerfil">Guardar Cambios</button></a>
                                    </div>
                                </div>
                    
                            <!--
                            <div class="row">
                                <div class="col EspForms Botones" >
                                    <button type="button " class="btn btn-secondary btn-lg">Crear cuenta</button>
                    
                                </div>
                                <div class="col EspForms Botones" >
                                    <button type="button" class="btn btn-light btn-lg">Acceder</button>
                                </div>
                            </div>
                        
                    
                                <input type="password" id="inputPassword5" class="form-control" aria-describedby="passwordHelpBlock" placeholder="Contaseña">
                    
                        -->
                            </form>
                        </div>
                    
                    </div>


            </div>

        
            <footer>JULIAN&NACHO SHOP All rights reserved</footer>

        </div>


    </div>

    
    <script>
        function mostrarImagen() {
            var archivo = document.getElementById('input-imagen').files[0];
            var vistaPrevia = document.getElementById('imagen-previa');
            var lector = new FileReader();

            lector.onloadend = function() {
            vistaPrevia.src = lector.result;
            vistaPrevia.style.display = 'block';
            }

            if (archivo) {
                lector.readAsDataURL(archivo);
            } else {
                vistaPrevia.src = '';
                vistaPrevia.style.display = 'none';
            }
        }

        $('#togglePassword').click(function() {
            var passwordInput = $('#contrasena');
            var icon = $(this).find('i');

            // Cambiar el tipo de entrada del campo de contraseña
            if (passwordInput.attr('type') === 'password') {
                passwordInput.attr('type', 'text');
                icon.removeClass('bi-eye-slash').addClass('bi-eye'); // Cambiar a ícono de ojo abierto
            } else {
                passwordInput.attr('type', 'password');
                icon.removeClass('bi-eye').addClass('bi-eye-slash'); // Cambiar a ícono de ojo cerrado
            }
        });

        $('#togglePassword2').click(function() {
            var passwordInput2 = $('#confirmar_contrasena');
            var icon2 = $(this).find('i');

            // Cambiar el tipo de entrada del campo de contraseña
            if (passwordInput2.attr('type') === 'password') {
                passwordInput2.attr('type', 'text');
                icon2.removeClass('bi-eye-slash').addClass('bi-eye'); // Cambiar a ícono de ojo abierto
            } else {
                passwordInput2.attr('type', 'password');
                icon2.removeClass('bi-eye').addClass('bi-eye-slash'); // Cambiar a ícono de ojo cerrado
            }
        });

        $(document).ready(function() {
            $.ajax({
                url: '../../Controllers/perfil.php', 
                method: 'GET',
                dataType: 'json',
                success: function(response) {
                    console.log(response);
                    $('#sesion').val(response.id);
                    $('#userName').val(response.usernm);
                    $('#correo').text(response.correo);
                    $('#contrasena').val(response.Contra);
                    if(response.sexo == "M"){
                        $('#Sexo').attr('placeholder', 'Hombre');
                        $('#Sexo').val(0)
                    }else{
                        $('#Sexo').attr('placeholder', 'Mujer');
                        $('#Sexo').val(1)
                    }
                    var dateObject = new Date(response.feNacimiento);
                    var formattedDate = dateObject.toISOString().slice(0, 10);
                    $('#fechaNac').val(formattedDate);
                    if(response.boolPublico == 0){
                        $('#privacidad').prop('checked', false);
                    }else{
                        $('#privacidad').prop('checked', true);
                    }
                    if(response.Rol == 0){
                        $('#tipo_cuenta').text('Comprador');
                    }else{
                        $('#tipo_cuenta').text('Vendedor');
                    }

                    if (response.imagen) {
                        var imagenBase64 = 'data:image/jpeg;base64,' + response.imagen;
                        $('#imagen-previa').attr('src', imagenBase64);
                    }
                },
                error: function(error) {
                    console.log('Error al obtener datos del perfil:', error);
                }
            });
        });

        $('#editForm').submit(function(event) {
            event.preventDefault();

            var formData = new FormData(this);

            $.ajax({
                type: 'POST',
                url: '../../Controllers/editUser.php',
                data: formData,
                contentType: false, 
                processData: false, 
                success: function(response) {
                    if (response === 'success') {
                        window.location.href = '../PaginaInicio.html';
                    } else {
                        $('#message').html(response);
                    }
                },
                error: function(response) {
                    $('#message').html("Hubo un error en la solicitud.");
                }
            });
        });
    </script>

</body>