<!DOCTYPE HTML>
<html>
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Info Producto</title>
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="../StylesNewProduct.CSS">

<style>
    #imagen-previa {
    max-width: 100%;
    height: auto;
    max-height: 200px; 
    margin-bottom: 20px;
    }
</style>

</head>



<body >

    <div class="container-fluid" >
        <div class="row">
            <div class="col-lg-2 col-md-3 sb Sidebar d-none d-sm-block"   >
                       
                    <div class="col">
                        <ul>
                            <a href="Perfil01.html"><li>Mi perfil</li></a>
                            <a href="Chat.html"><li>Mis chats</li></a>
                            <a href="../PaginaInicio.html"><li>Principal</li></a>
                            
                            <a href="../LoginVentanas/Login.html"><li>Cerrar Sesion</li></a>

                            

                        </ul>
                    </div>


            </div>
            <div class="col-lg-10 col-md-9 mb-5">
                <div class="row buscarDiv">

                    <div class="row logoRow">
                        <div class="col-11"><h1>LOGO</h1></div>
                        <div class="col-1"><a href="Carrito.html">
                            <img src="../../Public/cart.png" alt="Carrito" class="img-fluid h-50" alt="Responsive image">


                        </a></div>

                    </div>

                    <div class="col">
                    <hr>
                <input type="" class="form-control buscarTXT" id="exampleInputEmail1" aria-describedby="" placeholder="Buscar">
                <a href="../Buscar.html"><button type="button" class="btn btn-dark">Buscar</button> </a>
                <hr>
                </div>
                </div>
                <!----img src="Public/doggo.png" alt="Logo perro" width="87" class="img-fluid" alt="Responsive image" -->   

                &nbsp 

                <div class="container-fluid tjtNewPro">
                   <h2 class="ngt">Nuevo producto</h2><hr>

                   <form id="newProductForm" method="POST" enctype="multipart/form-data">
                    <div class="row h-100 fotosNP">
                        <div class="col EspForms">
                            <div class="form-group mb-2">
                                <label for="input-imagen" class="btn btn-primary btn-imagen">
                                    <i class="fa fa-image"></i>
                                </label>
                                <label for="imagen">Imagen de Producto</label>
                                <input type="file" name="img" class="mt-4 input-file visually-hidden" id="input-imagen" onchange="mostrarImagen()" accept="image/*" required>
                            </div>
                            <img id="imagen-previa" src="#" alt="Vista previa de la imagen" style="display: none;">
                        </div>
                
                        <div class="col-6 derecha">
                            <div class="row centerV">
                                <h4 class="titulo mitadRowD">Cantidad disponible:</h4> 
                                <input class="form-control mitadRowDF" placeholder="1 unidades" name="stock" required>
                            </div>
                            <div class="row">
                                <h4 class="titulo mitadRowD">Precio:</h4> 
                                <input class="form-control mitadRowDF" placeholder="$99.99" name="precio" required>
                            </div>
                            <div class="row">
                                <h4 class="titulo centerH">
                                    <input class="form-check-input mx-2" type="checkbox" value="" name="cotizable"> Cotizable
                                </h4>
                            </div>
                            <div class="row centerH">
                                <button id="Novo" type="submit" class="btn btn-dark btnNP">Crear producto</button>
                            </div> 
                        </div>
                    </div>
                    <div class="row px-4">
                        <div class="col-6">
                            <div class="row">
                                <h4 class="titulo mitadRowI">Nombre:</h4> 
                                <input class="form-control mitadRowIF" placeholder="MiProducto" name="nombre" required>
                            </div>
                            <div class="row">
                                <div class="d-flex">
                                    <h4 class="titulo mitadRowI">Descripción:</h4> 
                                    <input class="form-control w-50" placeholder="MiProducto" name="descripcion" required>
                                </div>
                            </div>
                            <div class="row">
                                <h4 class="titulo mitadRowI">Categoría existente:</h4> 
                                <select id="categoriaSelect" class="form-control mitadRowIF" name="categoria">
                                    <option>Cocina</option>
                                    <option>Decoración</option>
                                    <option>Arte</option>
                                </select>
                            </div>
                            <div class="row centerH">
                                <button id="btnCat" type="button" class="btn btn-dark btnNC">Nueva Categoria</button>
                            </div>
                        </div>
                    </div>
                </form>

                <dialog id="dlg" class="dlgLista" >
                        
                    <div  class="container" id="modalProducto">
            
                        <form id="newCategoriaForm" method="POST" enctype="multipart/form-data">
                            <h3> Nueva Categoria</h3>
                                <div class="col">
                                    <h4>Nombre: <input name="nombre" class="form-control" placeholder="Nombre" required></h4>                    
                                            
                                    <div class="d-flex">
                                        <button type="button" class="btn btn-light mx-2" id="btn2">Cerrar</button>
                                        <button type="submit" class="btn btn-light" id="btn3">Crear</button>
                                    </div> 
                                </div>  
                        </form>                             
                    </div>   
                
                </dialog>

                </div>

                    


            </div>

        
            <footer>JULIAN&NACHO SHOP All rights reserved</footer>

        </div>


    </div>

    <script>
        function mostrarImagen() {
          var archivo = document.getElementById('input-imagen').files[0];
          var vistaPrevia = document.getElementById('imagen-previa');
          var lector = new FileReader();
      
          lector.onloadend = function() {
            vistaPrevia.src = lector.result;
            vistaPrevia.style.display = 'block';
          }
      
          if (archivo) {
            lector.readAsDataURL(archivo);
          } else {
            vistaPrevia.src = '';
            vistaPrevia.style.display = 'none';
          }
        }

        $('#newProductForm').submit(function(event) {
            event.preventDefault();

            var formData = new FormData(this);

            $.ajax({
                type: 'POST',
                url: '../../Controllers/newProduct.php',
                data: formData,
                contentType: false, 
                processData: false, 
                success: function(response) {
                    window.location.href = 'Perfil01.html';
                },
                error: function() {
                    $('#message').html("Hubo un error en la solicitud.");
                }
            });
        });

        $("#btnCat").click(function(){
                document.getElementById('dlg').showModal();
            });

        $("#btn2").click(function(){
            document.getElementById('dlg').close();
        });

        $('#newCategoriaForm').submit(function(){
            var formData = new FormData(this);
            $.ajax({
                type: 'POST',
                url: '../../Controllers/newCategoria.php',
                data: formData,
                contentType: false, 
                processData: false, 
                success: function(response) {
                    alert("Categoria creada");
                },
                error: function() {
                    $('#message').html("Hubo un error en la solicitud.");
                }
            });
            document.getElementById('dlg').close();
        });

        $.ajax({
            url: '../../Controllers/cargaCategorias.php', 
            method: 'GET',
            dataType: 'json',
            success: function(response) {
                console.log(response);
                if (response.length > 0) {
                    var $select = $('#categoriaSelect');
                    // Limpia el select actual
                    $select.empty();
                    // Añade las nuevas opciones
                    response.forEach(function(categoria) {
                        // Asumiendo que cada objeto en response tiene un campo "nombre"
                        $select.append('<option value="' + categoria.ID + '">' + categoria.Nombre + '</option>');
                    });
                } else {
                    console.error('Respuesta inesperada:', response);
                }
            },
            error: function(error) {
                console.log('Error al obtener datos del perfil:', error);
            }
        });
    </script>

</body>